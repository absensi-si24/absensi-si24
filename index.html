<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Absensi - UNIVERSITAS ICHSAN GORONTALO UTARA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #1a5f7a;
            --secondary: #57c5b6;
            --accent: #002b5b;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
        }

        body {
            background-color: #f0f2f5;
            color: var(--dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

        .header {
            background: linear-gradient(135deg, var(--accent), var(--primary));
            color: white;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-bottom: 5px solid var(--secondary);
            position: relative;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .university-logo {
            height: 80px;
            width: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            background: white;
            border-radius: 8px;
            padding: 5px;
            border: 3px solid var(--secondary);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .university-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .university-text {
            flex: 1;
            text-align: center;
            padding: 0 10px;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: white;
        }

        .header h2 {
            font-size: 1.2rem;
            font-weight: 400;
            margin-bottom: 5px;
            color: rgba(255, 255, 255, 0.95);
        }

        .header h3 {
            font-size: 1rem;
            font-weight: 400;
            opacity: 0.9;
            color: rgba(255, 255, 255, 0.85);
        }

        .login-container, .main-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .active {
            display: block;
        }

        /* Login Card */
        .login-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 450px;
            margin: 60px auto;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h2 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .login-header p {
            color: var(--gray);
        }

        .login-tabs {
            display: flex;
            margin-bottom: 25px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #dee2e6;
        }

        .login-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: #f8f9fa;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .login-tab.active {
            background: var(--primary);
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s;
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background-color: var(--accent);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning);
            color: var(--dark);
        }

        .btn-info {
            background-color: #17a2b8;
            color: white;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 14px;
        }

        /* Navigation */
        .navbar {
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 15px 0;
            margin-bottom: 30px;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
        }

        .nav-brand i {
            margin-right: 10px;
            color: var(--secondary);
        }

        .nav-menu {
            display: flex;
            list-style: none;
        }

        .nav-item {
            margin-left: 20px;
        }

        .nav-link {
            color: var(--dark);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 15px;
            border-radius: 6px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }

        .nav-link i {
            margin-right: 8px;
        }

        .nav-link:hover, .nav-link.active {
            background-color: rgba(26, 95, 122, 0.1);
            color: var(--primary);
        }

        .user-info {
            display: flex;
            align-items: center;
            color: var(--dark);
            font-weight: 600;
        }

        .user-info i {
            margin-right: 8px;
            color: var(--primary);
        }

        .logout-btn {
            margin-left: 15px;
            background-color: #f8f9fa;
            color: var(--danger);
            border: 1px solid #dee2e6;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background-color: var(--danger);
            color: white;
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
            border-top: 4px solid var(--primary);
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .card-desc {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 40px;
            overflow-x: auto;
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f2f5;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background-color: #f8f9fa;
            color: var(--dark);
            font-weight: 600;
            padding: 15px;
            text-align: left;
            border-bottom: 2px solid #dee2e6;
        }

        .table td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .status-present {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success);
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .status-absent {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger);
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .status-late {
            background-color: rgba(255, 193, 7, 0.1);
            color: #b08b00;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        /* Page Content */
        .page-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page-content.active {
            display: block;
        }

        /* Footer */
        .footer {
            background-color: var(--accent);
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-top: 40px;
        }

        .footer p {
            margin-bottom: 5px;
        }

        /* TAMBAHAN: Info mahasiswa di dashboard */
        .student-info-card {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .student-info-card h3 {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .student-info-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 10px;
        }

        .student-info-item {
            flex: 1;
            min-width: 200px;
        }

        .student-info-label {
            font-weight: 600;
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .student-info-value {
            font-size: 1.1rem;
            font-weight: 700;
        }

        /* Modal untuk reset password */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }

        .modal {
            background: white;
            border-radius: 10px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: var(--primary);
            margin-bottom: 5px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                align-items: flex-start;
            }

            .nav-menu {
                margin-top: 15px;
                flex-wrap: wrap;
            }

            .nav-item {
                margin: 5px;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .login-card {
                padding: 30px 20px;
                margin: 30px auto;
            }

            .header-content {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .university-logo {
                height: 60px;
                width: 60px;
            }

            .header h1 {
                font-size: 1.4rem;
            }

            .header h2 {
                font-size: 1rem;
            }

            .header h3 {
                font-size: 0.9rem;
            }
        }

        /* TAMBAHAN: Form untuk tanggal absensi */
        .attendance-form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
            align-items: flex-end;
        }

        .form-group-inline {
            flex: 1;
            min-width: 200px;
        }

        .date-note {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 5px;
            font-style: italic;
        }

        .current-date-badge {
            background: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-block;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <!-- Header dengan Logo -->
    <header class="header">
        <div class="header-content">
            <div class="university-logo">
                <img src="c:\xampp\htdocs\unisan-logo.png" alt="Logo Universitas" id="university-logo-img">
            </div>
            <div class="university-text">
                <h1>UNIVERSITAS ICHSAN GORONTALO UTARA</h1>
                <h2>FAKULTAS ILMU KOMPUTER DAN SAINS</h2>
                <h3>PROGRAM STUDI SISTEM INFORMASI - Semester 4</h3>
            </div>
        </div>
    </header>

    <!-- Login Container -->
    <div class="container">
        <div id="login-container" class="login-container active">
            <div class="login-card">
                <div class="login-header">
                    <h2>Sistem Absensi Mahasiswa</h2>
                    <p>Silakan login untuk mengakses sistem</p>
                </div>
                
                <div class="login-tabs">
                    <div class="login-tab active" id="tab-mahasiswa">Mahasiswa</div>
                    <div class="login-tab" id="tab-admin">Admin</div>
                </div>
                
                <form id="login-form">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" class="form-control" placeholder="Masukkan NIM" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" class="form-control" placeholder="Masukkan password" required>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt"></i> Masuk
                        </button>
                    </div>
                </form>
                
                <div class="demo-info" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 6px; font-size: 0.9rem;">
                    <p style="margin-bottom: 5px; font-weight: 600;">Info Login Demo:</p>
                    <p style="margin-bottom: 5px;">Mahasiswa: NIM (contoh: 2021001), Password: mahasiswa123</p>
                    <p>Admin: username: admin, password: admin123</p>
                </div>
            </div>
        </div>
        
        <!-- Main Content (Akan ditampilkan setelah login) -->
        <div id="main-content" class="main-content">
            <!-- Navigation -->
            <nav class="navbar">
                <div class="container nav-container">
                    <div class="nav-brand">
                        <i class="fas fa-calendar-check"></i>
                        <span>Absensi SI Semester 4</span>
                    </div>
                    
                    <ul class="nav-menu" id="nav-menu">
                        <li class="nav-item">
                            <a href="#" class="nav-link active" data-page="dashboard">
                                <i class="fas fa-home"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-page="attendance">
                                <i class="fas fa-clipboard-check"></i> Absensi
                            </a>
                        </li>
                        <li class="nav-item admin-only">
                            <a href="#" class="nav-link" data-page="students">
                                <i class="fas fa-users"></i> Data Mahasiswa
                            </a>
                        </li>
                        <li class="nav-item admin-only">
                            <a href="#" class="nav-link" data-page="courses">
                                <i class="fas fa-book"></i> Mata Kuliah
                            </a>
                        </li>
                        <li class="nav-item admin-only">
                            <a href="#" class="nav-link" data-page="report">
                                <i class="fas fa-chart-bar"></i> Laporan
                            </a>
                        </li>
                    </ul>
                    
                    <div class="user-info" id="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="current-user">Admin</span>
                        <button class="logout-btn" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </nav>
            
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page-content active">
                <!-- Info Mahasiswa (hanya tampil untuk mahasiswa) -->
                <div id="student-info-container" style="display: none;">
                    <div class="student-info-card">
                        <h3><i class="fas fa-user-graduate"></i> Informasi Mahasiswa</h3>
                        <div class="student-info-row">
                            <div class="student-info-item">
                                <div class="student-info-label">Nama Lengkap</div>
                                <div class="student-info-value" id="student-name">-</div>
                            </div>
                            <div class="student-info-item">
                                <div class="student-info-label">NIM</div>
                                <div class="student-info-value" id="student-nim">-</div>
                            </div>
                            <div class="student-info-item">
                                <div class="student-info-label">Kelas</div>
                                <div class="student-info-value" id="student-class">-</div>
                            </div>
                            <div class="student-info-item">
                                <div class="student-info-label">Kategori</div>
                                <div class="student-info-value" id="student-category">-</div>
                            </div>
                        </div>
                        <div class="student-info-row">
                            <div class="student-info-item">
                                <div class="student-info-label">Jenis Kelamin</div>
                                <div class="student-info-value" id="student-gender">-</div>
                            </div>
                            <div class="student-info-item">
                                <div class="student-info-label">Status Kehadiran</div>
                                <div class="student-info-value" id="student-attendance-rate">-</div>
                            </div>
                            <div class="student-info-item">
                                <button class="btn btn-warning btn-sm" id="student-change-password-btn">
                                    <i class="fas fa-key"></i> Ganti Password
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-title">Total Mahasiswa</div>
                        <div class="card-value" id="total-mahasiswa">32</div>
                        <div class="card-desc">30 Reguler + 2 Karyawan</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="card-title">Mata Kuliah</div>
                        <div class="card-value" id="total-matkul">9</div>
                        <div class="card-desc">Semester 4</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <div class="card-title">Kehadiran Hari Ini</div>
                        <div class="card-value" id="attendance-today">78%</div>
                        <div class="card-desc" id="attendance-desc">25 dari 32 hadir</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="card-title">Tanggal</div>
                        <div class="card-value" id="current-date">...</div>
                        <div class="card-desc" id="current-time">...</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <h3 class="section-title">
                        <i class="fas fa-history"></i> Riwayat Absensi Terbaru
                    </h3>
                    <table class="table" id="recent-attendance">
                        <thead>
                            <tr>
                                <th>Nama</th>
                                <th>NIM</th>
                                <th>Mata Kuliah</th>
                                <th>Tanggal</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="attendance-table-body">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Attendance Page -->
            <div id="attendance-page" class="page-content">
                <div class="table-container">
                    <h3 class="section-title">
                        <i class="fas fa-clipboard-check"></i> Absensi Mahasiswa
                    </h3>
                    
                    <div id="mahasiswa-view" style="display: none;">
                        <div style="padding: 20px; background-color: #f8f9fa; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="margin-bottom: 15px; color: var(--primary);">Absensi Mahasiswa</h4>
                            
                            <!-- FORM ABSENSI DENGAN TANGGAL -->
                            <div class="attendance-form-row">
                                <div class="form-group-inline">
                                    <label for="attendance-date">Tanggal Absensi:</label>
                                    <input type="date" id="attendance-date" class="form-control" value="<?php echo date('Y-m-d'); ?>">
                                    <div class="date-note">Pilih tanggal untuk absensi</div>
                                </div>
                                
                                <div class="form-group-inline">
                                    <label for="student-course-select">Pilih Mata Kuliah:</label>
                                    <select id="student-course-select" class="form-control">
                                        <option value="">-- Pilih Mata Kuliah --</option>
                                        <!-- Options akan diisi oleh JavaScript -->
                                    </select>
                                </div>
                                
                                <div class="form-group-inline">
                                    <label for="student-status">Status Kehadiran:</label>
                                    <select id="student-status" class="form-control">
                                        <option value="Hadir">Hadir</option>
                                        <option value="Izin">Izin</option>
                                        <option value="Sakit">Sakit</option>
                                        <option value="Alpha">Alpha</option>
                                    </select>
                                </div>
                                
                                <div class="form-group-inline">
                                    <button class="btn btn-success" id="submit-student-attendance">
                                        <i class="fas fa-check-circle"></i> Submit Absensi
                                    </button>
                                    <button class="btn btn-info" id="check-existing-attendance" style="margin-top: 10px;">
                                        <i class="fas fa-search"></i> Cek Absensi Tanggal Ini
                                    </button>
                                </div>
                            </div>
                            
                            <div style="margin-top: 10px; padding: 10px; background-color: #e7f4ff; border-radius: 5px;">
                                <i class="fas fa-info-circle"></i> <strong>Catatan:</strong> Anda dapat memilih tanggal untuk absensi di masa lalu atau hari ini. Untuk mengubah absensi yang sudah ada, pilih tanggal yang sama.
                            </div>
                        </div>
                        
                        <div style="padding: 15px; background-color: #e7f4ff; border-radius: 8px; margin-bottom: 20px;">
                            <h5 style="color: var(--primary); margin-bottom: 10px;">
                                <i class="fas fa-history"></i> Riwayat Absensi Anda
                                <span id="attendance-history-date" class="current-date-badge">Semua Tanggal</span>
                            </h5>
                            
                            <div style="margin-bottom: 15px;">
                                <label for="history-date-filter">Filter berdasarkan tanggal:</label>
                                <input type="date" id="history-date-filter" class="form-control" style="width: 200px; display: inline-block; margin-left: 10px;">
                                <button class="btn btn-sm btn-secondary" id="clear-history-filter" style="margin-left: 10px;">
                                    <i class="fas fa-times"></i> Hapus Filter
                                </button>
                            </div>
                            
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Mata Kuliah</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="student-attendance-history">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="admin-view">
                        <div style="margin-bottom: 20px;">
                            <label for="course-select">Pilih Mata Kuliah:</label>
                            <select id="course-select" class="form-control" style="width: 300px; display: inline-block; margin-left: 10px;">
                                <option value="">-- Pilih Mata Kuliah --</option>
                                <!-- Options akan diisi oleh JavaScript -->
                            </select>
                            
                            <label for="admin-date-select" style="margin-left: 20px;">Tanggal:</label>
                            <input type="date" id="admin-date-select" class="form-control" style="width: 200px; display: inline-block; margin-left: 10px;">
                        </div>
                        
                        <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <button class="btn btn-info" id="load-admin-attendance">
                                    <i class="fas fa-sync-alt"></i> Muat Data Absensi
                                </button>
                            </div>
                            <div>
                                <span id="admin-attendance-info" style="color: var(--primary); font-weight: 600;"></span>
                            </div>
                        </div>
                        
                        <table class="table" id="today-attendance">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama</th>
                                    <th>NIM</th>
                                    <th>Kelas</th>
                                    <th>Kategori</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="today-attendance-body">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                        
                        <div style="text-align: right; margin-top: 20px;">
                            <button class="btn btn-success" id="save-attendance">
                                <i class="fas fa-save"></i> Simpan Semua Absensi
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Students Page (Admin Only) -->
            <div id="students-page" class="page-content">
                <div class="table-container">
                    <h3 class="section-title">
                        <i class="fas fa-users"></i> Data Mahasiswa Semester 4
                    </h3>
                    <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" id="add-student-btn">
                                <i class="fas fa-plus"></i> Tambah Mahasiswa
                            </button>
                            <button class="btn btn-success" id="bulk-add-btn">
                                <i class="fas fa-file-import"></i> Import dari Excel
                            </button>
                        </div>
                        <div>
                            <input type="text" id="search-student" class="form-control" placeholder="Cari mahasiswa..." style="width: 300px;">
                        </div>
                    </div>
                    <table class="table" id="students-table">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>NIM</th>
                                <th>Nama</th>
                                <th>Kelas</th>
                                <th>Jenis Kelamin</th>
                                <th>Kategori</th>
                                <th>Kehadiran</th>
                                <th>Password</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="students-table-body">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Courses Page (Admin Only) -->
            <div id="courses-page" class="page-content">
                <div class="table-container">
                    <h3 class="section-title">
                        <i class="fas fa-book"></i> Mata Kuliah Semester 4
                    </h3>
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-primary" id="add-course-btn">
                            <i class="fas fa-plus"></i> Tambah Mata Kuliah
                        </button>
                    </div>
                    <table class="table" id="courses-table">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Kode</th>
                                <th>Nama Mata Kuliah</th>
                                <th>SKS</th>
                                <th>Dosen Pengampu</th>
                                <th>Jadwal</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="courses-table-body">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Report Page (Admin Only) -->
            <div id="report-page" class="page-content">
                <div class="table-container">
                    <h3 class="section-title">
                        <i class="fas fa-chart-bar"></i> Laporan Kehadiran
                    </h3>
                    <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <div>
                            <label for="report-month">Bulan:</label>
                            <select id="report-month" class="form-control" style="width: 150px; display: inline-block; margin-left: 10px;">
                                <option value="all">Semua Bulan</option>
                                <!-- Options akan diisi oleh JavaScript -->
                            </select>
                        </div>
                        
                        <div>
                            <label for="report-course">Mata Kuliah:</label>
                            <select id="report-course" class="form-control" style="width: 200px; display: inline-block; margin-left: 10px;">
                                <option value="all">Semua Mata Kuliah</option>
                                <!-- Options akan diisi oleh JavaScript -->
                            </select>
                        </div>
                        
                        <div>
                            <label for="report-class">Kelas:</label>
                            <select id="report-class" class="form-control" style="width: 120px; display: inline-block; margin-left: 10px;">
                                <option value="all">Semua Kelas</option>
                                <option value="A">Kelas A</option>
                                <option value="B">Kelas B</option>
                                <option value="C">Kelas C</option>
                                <option value="K">Kelas K</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="report-start-date">Dari Tanggal:</label>
                            <input type="date" id="report-start-date" class="form-control" style="width: 150px; display: inline-block; margin-left: 10px;">
                        </div>
                        
                        <div>
                            <label for="report-end-date">Sampai Tanggal:</label>
                            <input type="date" id="report-end-date" class="form-control" style="width: 150px; display: inline-block; margin-left: 10px;">
                        </div>
                        
                        <div>
                            <button class="btn btn-primary" id="generate-report">
                                <i class="fas fa-filter"></i> Filter Laporan
                            </button>
                            <button class="btn btn-success" id="print-report" style="margin-left: 10px;">
                                <i class="fas fa-print"></i> Cetak Laporan
                            </button>
                        </div>
                    </div>
                    
                    <div style="overflow-x: auto;">
                        <table class="table" id="report-table">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>NIM</th>
                                    <th>Nama</th>
                                    <th>Kelas</th>
                                    <th>Mata Kuliah</th>
                                    <th>Hadir</th>
                                    <th>Izin</th>
                                    <th>Sakit</th>
                                    <th>Alpha</th>
                                    <th>Total</th>
                                    <th>Persentase</th>
                                </tr>
                            </thead>
                            <tbody id="report-table-body">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>Sistem Absensi Mahasiswa - UNIVERSITAS ICHSAN GORONTALO UTARA</p>
            <p>Fakultas Ilmu Komputer dan Sains - Program Studi Sistem Informasi</p>
            <p>Â© 2023 - Semester 4</p>
        </div>
    </footer>

    <!-- Modal Reset Password -->
    <div id="reset-password-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Reset Password</h3>
                <p id="reset-student-info">Untuk: -</p>
            </div>
            <div class="form-group">
                <label for="new-password">Password Baru:</label>
                <input type="password" id="new-password" class="form-control" placeholder="Masukkan password baru">
            </div>
            <div class="form-group">
                <label for="confirm-password">Konfirmasi Password:</label>
                <input type="password" id="confirm-password" class="form-control" placeholder="Konfirmasi password baru">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancel-reset-btn">Batal</button>
                <button class="btn btn-primary" id="save-password-btn">Simpan Password</button>
            </div>
        </div>
    </div>

    <!-- Modal Ganti Password (untuk mahasiswa) -->
    <div id="change-password-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Ganti Password</h3>
                <p>Ganti password akun Anda</p>
            </div>
            <div class="form-group">
                <label for="current-password">Password Saat Ini:</label>
                <input type="password" id="current-password" class="form-control" placeholder="Masukkan password saat ini">
            </div>
            <div class="form-group">
                <label for="new-password-student">Password Baru:</label>
                <input type="password" id="new-password-student" class="form-control" placeholder="Masukkan password baru">
            </div>
            <div class="form-group">
                <label for="confirm-password-student">Konfirmasi Password Baru:</label>
                <input type="password" id="confirm-password-student" class="form-control" placeholder="Konfirmasi password baru">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancel-change-btn">Batal</button>
                <button class="btn btn-primary" id="save-change-btn">Ganti Password</button>
            </div>
        </div>
    </div>

    <!-- Modal Edit Absensi -->
    <div id="edit-attendance-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Absensi</h3>
                <p id="edit-attendance-info">Edit absensi untuk: -</p>
            </div>
            <div class="form-group">
                <label for="edit-attendance-date">Tanggal:</label>
                <input type="date" id="edit-attendance-date" class="form-control">
            </div>
            <div class="form-group">
                <label for="edit-course">Mata Kuliah:</label>
                <select id="edit-course" class="form-control">
                    <option value="">-- Pilih Mata Kuliah --</option>
                    <!-- Options akan diisi oleh JavaScript -->
                </select>
            </div>
            <div class="form-group">
                <label for="edit-status">Status Kehadiran:</label>
                <select id="edit-status" class="form-control">
                    <option value="Hadir">Hadir</option>
                    <option value="Izin">Izin</option>
                    <option value="Sakit">Sakit</option>
                    <option value="Alpha">Alpha</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancel-edit-btn">Batal</button>
                <button class="btn btn-primary" id="save-edit-btn">Simpan Perubahan</button>
                <button class="btn btn-danger" id="delete-attendance-btn">Hapus Absensi</button>
            </div>
        </div>
    </div>

    <script>
        // Data mata kuliah semester 4
        const courses = [
            { code: "SI401", name: "Pemrograman Web", sks: 3, lecturer: "Dr. Ahmad Yani, M.Kom", schedule: "Senin, 08:00-10:30" },
            { code: "SI402", name: "Basis Data Lanjutan", sks: 3, lecturer: "Maya Sari, M.T.I", schedule: "Senin, 13:00-15:30" },
            { code: "SI403", name: "Sistem Informasi Manajemen", sks: 3, lecturer: "Prof. Dr. Bambang Sudarto", schedule: "Selasa, 08:00-10:30" },
            { code: "SI404", name: "Analisis dan Desain Sistem", sks: 3, lecturer: "Rina Dewi, M.Kom", schedule: "Selasa, 13:00-15:30" },
            { code: "SI405", name: "Jaringan Komputer", sks: 3, lecturer: "Dedi Susanto, M.T", schedule: "Rabu, 08:00-10:30" },
            { code: "SI406", name: "Interaksi Manusia Komputer", sks: 2, lecturer: "Siti Fatimah, M.Kom", schedule: "Rabu, 10:30-12:10" },
            { code: "SI407", name: "Statistika dan Probabilitas", sks: 3, lecturer: "Dr. Rudi Hermawan, M.Si", schedule: "Kamis, 08:00-10:30" },
            { code: "SI408", name: "Keamanan Sistem Informasi", sks: 2, lecturer: "Irfan Setiawan, M.T", schedule: "Kamis, 13:00-14:40" },
            { code: "SI409", name: "Kewirausahaan Teknologi", sks: 2, lecturer: "Hendra Pratama, M.M", schedule: "Jumat, 08:00-09:40" }
        ];

        // Data mahasiswa (30 reguler + 2 karyawan)
        let students = JSON.parse(localStorage.getItem('studentsData')) || [
            // 30 mahasiswa reguler
            { nim: "2021001", name: "Ahmad Fauzi", class: "A", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021002", name: "Budi Santoso", class: "A", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021003", name: "Cindy Nurhaliza", class: "A", gender: "P", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021004", name: "Dedi Setiawan", class: "A", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021005", name: "Eka Putri", class: "A", gender: "P", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021006", name: "Fajar Ramadan", class: "A", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021007", name: "Gita Maharani", class: "A", gender: "P", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021008", name: "Hendra Pratama", class: "A", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021009", name: "Indah Permata", class: "A", gender: "P", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021010", name: "Joko Susilo", class: "A", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021011", name: "Kartika Sari", class: "B", gender: "P", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021012", name: "Lukman Hakim", class: "B", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021013", name: "Maya Indah", class: "B", gender: "P", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021014", name: "Nugroho Adi", class: "B", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021015", name: "Oki Setiawan", class: "B", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021016", name: "Putri Ayu", class: "B", gender: "P", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021017", name: "Rizki Amelia", class: "B", gender: "P", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021018", name: "Sandi Pratama", class: "B", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021019", name: "Tuti Handayani", class: "B", gender: "P", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021020", name: "Umar Said", class: "B", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021021", name: "Vina Melinda", class: "C", gender: "P", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021022", name: "Wahyu Ramadhan", class: "C", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021023", name: "Yuni Sartika", class: "C", gender: "P", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021024", name: "Zainal Abidin", class: "C", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021025", name: "Andi Permana", class: "C", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021026", name: "Bunga Citra", class: "C", gender: "P", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021027", name: "Chandra Wijaya", class: "C", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021028", name: "Dewi Lestari", class: "C", gender: "P", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021029", name: "Eko Prasetyo", class: "C", gender: "L", category: "Reguler", password: "mahasiswa123" },
            { nim: "2021030", name: "Fitriani", class: "C", gender: "P", category: "Reguler", password: "mahasiswa123" },
            // 2 mahasiswa karyawan
            { nim: "2021031", name: "Gilang Ramadhan", class: "K", gender: "L", category: "Karyawan", password: "mahasiswa123" },
            { nim: "2021032", name: "Hana Safitri", class: "K", gender: "P", category: "Karyawan", password: "mahasiswa123" }
        ];

        // Data absensi contoh
        let attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || [];
        
        // Inisialisasi data absensi jika kosong
        if (attendanceData.length === 0) {
            // Generate data absensi contoh untuk 7 hari terakhir
            const today = new Date();
            const courseNames = ["Pemrograman Web", "Basis Data Lanjutan", "Sistem Informasi Manajemen"];
            const statuses = ["Hadir", "Izin", "Sakit", "Alpha"];
            
            for (let i = 0; i < 20; i++) {
                const randomStudent = students[Math.floor(Math.random() * students.length)];
                const randomCourse = courseNames[Math.floor(Math.random() * courseNames.length)];
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                
                // Tanggal random dalam 7 hari terakhir
                const randomDate = new Date(today);
                randomDate.setDate(today.getDate() - Math.floor(Math.random() * 7));
                
                attendanceData.push({
                    nim: randomStudent.nim,
                    name: randomStudent.name,
                    course: randomCourse,
                    date: randomDate.toISOString().split('T')[0],
                    status: randomStatus,
                    timestamp: randomDate.getTime()
                });
            }
            
            localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
        }

        // Simpan data siswa ke localStorage
        if (!localStorage.getItem('studentsData')) {
            localStorage.setItem('studentsData', JSON.stringify(students));
        }

        // Variabel global untuk status login
        let currentUser = null;
        let isAdmin = false;
        let currentStudentData = null;
        let attendanceToEdit = null;

        // Login Tabs
        document.getElementById('tab-mahasiswa').addEventListener('click', function() {
            document.getElementById('tab-mahasiswa').classList.add('active');
            document.getElementById('tab-admin').classList.remove('active');
            document.getElementById('username').placeholder = "Masukkan NIM";
        });
        
        document.getElementById('tab-admin').addEventListener('click', function() {
            document.getElementById('tab-admin').classList.add('active');
            document.getElementById('tab-mahasiswa').classList.remove('active');
            document.getElementById('username').placeholder = "Masukkan username admin";
        });

        // Login Form Submission
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const isAdminTab = document.getElementById('tab-admin').classList.contains('active');
            
            if (isAdminTab) {
                // Login sebagai admin
                if (username === "admin" && password === "admin2712") {
                    loginSuccess("Admin", true);
                } else {
                    alert("Username atau password admin salah!");
                }
            } else {
                // Login sebagai mahasiswa (cek apakah NIM valid)
                const student = students.find(s => s.nim === username);
                if (student && student.password === password) {
                    currentStudentData = student;
                    loginSuccess(student.name, false, student.nim);
                } else {
                    alert("NIM atau password mahasiswa salah!");
                }
            }
        });

        // Fungsi login berhasil
        function loginSuccess(userName, adminStatus, nim = null) {
            // Simpan info login
            currentUser = { name: userName, nim: nim, isAdmin: adminStatus };
            isAdmin = adminStatus;
            
            // Update UI
            document.getElementById('current-user').textContent = userName;
            
            // Tampilkan halaman utama dan sembunyikan login
            document.getElementById('login-container').classList.remove('active');
            document.getElementById('main-content').classList.add('active');
            
            // Atur tampilan berdasarkan role
            if (!isAdmin) {
                // Sembunyikan menu admin
                document.querySelectorAll('.admin-only').forEach(item => {
                    item.style.display = 'none';
                });
                
                // Tampilkan view mahasiswa di halaman absensi
                document.getElementById('mahasiswa-view').style.display = 'block';
                document.getElementById('admin-view').style.display = 'none';
                
                // Tampilkan info mahasiswa di dashboard
                document.getElementById('student-info-container').style.display = 'block';
                
                // Set halaman default ke dashboard untuk mahasiswa
                showPage('dashboard');
                
                // Load data khusus mahasiswa
                loadStudentAttendanceHistory(nim);
                populateStudentCourseSelect();
                loadStudentInfo();
            } else {
                // Tampilkan semua menu untuk admin
                document.querySelectorAll('.admin-only').forEach(item => {
                    item.style.display = 'block';
                });
                
                // Tampilkan view admin di halaman absensi
                document.getElementById('mahasiswa-view').style.display = 'none';
                document.getElementById('admin-view').style.display = 'block';
                
                // Sembunyikan info mahasiswa di dashboard
                document.getElementById('student-info-container').style.display = 'none';
                
                // Set halaman default ke dashboard untuk admin
                showPage('dashboard');
                
                // Load data admin
                populateCourseSelect();
                loadStudentsTable();
                loadCoursesTable();
                loadReportData();
                
                // Set tanggal default untuk admin
                document.getElementById('admin-date-select').value = new Date().toISOString().split('T')[0];
            }
            
            // Inisialisasi data umum
            updateDateTime();
            loadDashboardData();
            
            // Start waktu real-time
            setInterval(updateDateTime, 1000);
        }

        // Load info mahasiswa untuk dashboard
        function loadStudentInfo() {
            if (!currentStudentData) return;
            
            document.getElementById('student-name').textContent = currentStudentData.name;
            document.getElementById('student-nim').textContent = currentStudentData.nim;
            document.getElementById('student-class').textContent = currentStudentData.class;
            document.getElementById('student-category').textContent = currentStudentData.category;
            document.getElementById('student-gender').textContent = currentStudentData.gender === 'L' ? 'Laki-laki' : 'Perempuan';
            
            // Hitung persentase kehadiran mahasiswa
            const studentAttendance = attendanceData.filter(a => a.nim === currentStudentData.nim);
            const presentCount = studentAttendance.filter(a => a.status === "Hadir").length;
            const totalCount = studentAttendance.length;
            const percentage = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
            
            document.getElementById('student-attendance-rate').textContent = `${percentage}% (${presentCount}/${totalCount})`;
        }

        // Fungsi untuk menampilkan halaman
        function showPage(pageName) {
            // Sembunyikan semua halaman
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // Tampilkan halaman yang dipilih
            document.getElementById(pageName + '-page').classList.add('active');
            
            // Update menu navigasi
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === pageName) {
                    link.classList.add('active');
                }
            });
        }

        // Setup event listener
        window.addEventListener('DOMContentLoaded', function() {
            // Reset semua halaman
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // Tampilkan halaman login
            document.getElementById('login-container').classList.add('active');
            
            // Set tanggal default untuk absensi mahasiswa
            document.getElementById('attendance-date').value = new Date().toISOString().split('T')[0];
            
            // Setup logo universitas
            const logoImg = document.getElementById('university-logo-img');
            // Ini adalah placeholder, ganti dengan URL logo universitas yang sesungguhnya
            logoImg.src = "c:\xampp\htdocs\unisan-logo.png";
            logoImg.alt = "Logo Universitas Ichsan Gorontalo Utara";
            
            // Setup event listener untuk logout
            document.getElementById('logout-btn').addEventListener('click', function() {
                if (confirm("Apakah Anda yakin ingin logout?")) {
                    // Reset state
                    currentUser = null;
                    isAdmin = false;
                    currentStudentData = null;
                    
                    // Kembali ke halaman login
                    document.getElementById('main-content').classList.remove('active');
                    document.getElementById('login-container').classList.add('active');
                    
                    // Reset form login
                    document.getElementById('login-form').reset();
                    document.getElementById('tab-mahasiswa').click();
                }
            });
            
            // Setup modal untuk reset password
            document.getElementById('cancel-reset-btn').addEventListener('click', function() {
                document.getElementById('reset-password-modal').style.display = 'none';
            });
            
            document.getElementById('save-password-btn').addEventListener('click', function() {
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                const studentNim = document.getElementById('save-password-btn').getAttribute('data-nim');
                
                if (!newPassword || !confirmPassword) {
                    alert("Harap isi semua field!");
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    alert("Password dan konfirmasi password tidak cocok!");
                    return;
                }
                
                // Update password
                const student = students.find(s => s.nim === studentNim);
                if (student) {
                    student.password = newPassword;
                    localStorage.setItem('studentsData', JSON.stringify(students));
                    alert("Password berhasil direset!");
                    document.getElementById('reset-password-modal').style.display = 'none';
                    loadStudentsTable();
                }
            });
            
            // Setup modal ganti password untuk mahasiswa
            document.getElementById('student-change-password-btn').addEventListener('click', function() {
                document.getElementById('change-password-modal').style.display = 'flex';
            });
            
            document.getElementById('cancel-change-btn').addEventListener('click', function() {
                document.getElementById('change-password-modal').style.display = 'none';
            });
            
            document.getElementById('save-change-btn').addEventListener('click', function() {
                const currentPassword = document.getElementById('current-password').value;
                const newPassword = document.getElementById('new-password-student').value;
                const confirmPassword = document.getElementById('confirm-password-student').value;
                
                if (!currentPassword || !newPassword || !confirmPassword) {
                    alert("Harap isi semua field!");
                    return;
                }
                
                // Cek password saat ini
                if (currentPassword !== currentStudentData.password) {
                    alert("Password saat ini salah!");
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    alert("Password baru dan konfirmasi password tidak cocok!");
                    return;
                }
                
                // Update password
                currentStudentData.password = newPassword;
                const studentIndex = students.findIndex(s => s.nim === currentStudentData.nim);
                if (studentIndex !== -1) {
                    students[studentIndex].password = newPassword;
                    localStorage.setItem('studentsData', JSON.stringify(students));
                    alert("Password berhasil diubah!");
                    document.getElementById('change-password-modal').style.display = 'none';
                    
                    // Clear modal fields
                    document.getElementById('current-password').value = '';
                    document.getElementById('new-password-student').value = '';
                    document.getElementById('confirm-password-student').value = '';
                }
            });
            
            // Setup modal edit absensi
            document.getElementById('cancel-edit-btn').addEventListener('click', function() {
                document.getElementById('edit-attendance-modal').style.display = 'none';
            });
            
            document.getElementById('save-edit-btn').addEventListener('click', function() {
                const newDate = document.getElementById('edit-attendance-date').value;
                const newCourse = document.getElementById('edit-course').value;
                const newStatus = document.getElementById('edit-status').value;
                
                if (!newDate || !newCourse) {
                    alert("Harap isi semua field!");
                    return;
                }
                
                // Update absensi
                if (attendanceToEdit) {
                    attendanceToEdit.date = newDate;
                    attendanceToEdit.course = newCourse;
                    attendanceToEdit.status = newStatus;
                    attendanceToEdit.timestamp = new Date(newDate).getTime();
                    
                    localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
                    alert("Absensi berhasil diperbarui!");
                    document.getElementById('edit-attendance-modal').style.display = 'none';
                    
                    // Refresh data
                    if (!isAdmin) {
                        loadStudentAttendanceHistory(currentUser.nim);
                    }
                    loadDashboardData();
                }
            });
            
            document.getElementById('delete-attendance-btn').addEventListener('click', function() {
                if (confirm("Apakah Anda yakin ingin menghapus absensi ini?")) {
                    if (attendanceToEdit) {
                        const index = attendanceData.findIndex(a => 
                            a.nim === attendanceToEdit.nim && 
                            a.date === attendanceToEdit.date && 
                            a.course === attendanceToEdit.course
                        );
                        
                        if (index !== -1) {
                            attendanceData.splice(index, 1);
                            localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
                            alert("Absensi berhasil dihapus!");
                            document.getElementById('edit-attendance-modal').style.display = 'none';
                            
                            // Refresh data
                            if (!isAdmin) {
                                loadStudentAttendanceHistory(currentUser.nim);
                            }
                            loadDashboardData();
                        }
                    }
                }
            });
            
            // Setup tombol import dari Excel (placeholder)
            document.getElementById('bulk-add-btn').addEventListener('click', function() {
                alert("Fitur import dari Excel akan segera tersedia. Untuk sekarang, silakan tambah mahasiswa satu per satu.");
            });
            
            // Setup tombol cek absensi tanggal untuk mahasiswa
            document.getElementById('check-existing-attendance').addEventListener('click', function() {
                const date = document.getElementById('attendance-date').value;
                const course = document.getElementById('student-course-select').value;
                
                if (!date || !course) {
                    alert("Pilih tanggal dan mata kuliah terlebih dahulu!");
                    return;
                }
                
                // Cari absensi yang sudah ada
                const existingAttendance = attendanceData.find(a => 
                    a.nim === currentUser.nim && 
                    a.date === date && 
                    a.course === course
                );
                
                if (existingAttendance) {
                    alert(`Anda sudah absen untuk ${course} pada tanggal ${formatDate(date)} dengan status: ${existingAttendance.status}`);
                    document.getElementById('student-status').value = existingAttendance.status;
                } else {
                    alert(`Belum ada absensi untuk ${course} pada tanggal ${formatDate(date)}`);
                }
            });
            
            // Setup filter tanggal untuk riwayat absensi mahasiswa
            document.getElementById('history-date-filter').addEventListener('change', function() {
                loadStudentAttendanceHistory(currentUser.nim);
            });
            
            document.getElementById('clear-history-filter').addEventListener('click', function() {
                document.getElementById('history-date-filter').value = '';
                loadStudentAttendanceHistory(currentUser.nim);
            });
            
            // Setup tombol load data absensi untuk admin
            document.getElementById('load-admin-attendance').addEventListener('click', function() {
                loadTodayAttendance();
            });
        });

        // Navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                const pageName = this.getAttribute('data-page');
                showPage(pageName);
                
                // Jika admin dan halaman absensi, load data
                if (pageName === 'attendance' && isAdmin) {
                    loadTodayAttendance();
                }
                
                // Jika mahasiswa dan halaman absensi, load riwayat
                if (pageName === 'attendance' && !isAdmin) {
                    loadStudentAttendanceHistory(currentUser.nim);
                }
            });
        });

        // Update tanggal dan waktu
        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('id-ID', options);
            document.getElementById('current-time').textContent = now.toLocaleTimeString('id-ID');
        }

        // Load data dashboard
        function loadDashboardData() {
            // Hitung persentase kehadiran hari ini
            const today = new Date().toISOString().split('T')[0];
            const todayAttendance = attendanceData.filter(a => a.date === today);
            const presentToday = todayAttendance.filter(a => a.status === "Hadir").length;
            const totalToday = todayAttendance.length > 0 ? todayAttendance.length : students.length;
            const percentage = totalToday > 0 ? Math.round((presentToday / totalToday) * 100) : 0;
            
            document.getElementById('attendance-today').textContent = percentage + "%";
            document.getElementById('attendance-desc').textContent = presentToday + " dari " + totalToday + " hadir";
            
            // Tampilkan riwayat absensi terbaru
            const recentAttendance = attendanceData
                .sort((a, b) => b.timestamp - a.timestamp)
                .slice(0, 10);
            
            const tbody = document.getElementById('attendance-table-body');
            tbody.innerHTML = '';
            
            if (recentAttendance.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" style="text-align: center;">Belum ada data absensi</td>`;
                tbody.appendChild(row);
            } else {
                recentAttendance.forEach(record => {
                    const row = document.createElement('tr');
                    
                    let statusClass = 'status-absent';
                    if (record.status === 'Hadir') statusClass = 'status-present';
                    else if (record.status === 'Izin' || record.status === 'Sakit') statusClass = 'status-late';
                    
                    row.innerHTML = `
                        <td>${record.name}</td>
                        <td>${record.nim}</td>
                        <td>${record.course}</td>
                        <td>${formatDate(record.date)}</td>
                        <td><span class="${statusClass}">${record.status}</span></td>
                    `;
                    
                    tbody.appendChild(row);
                });
            }
        }

        // Populate course select dropdown untuk admin
        function populateCourseSelect() {
            const select = document.getElementById('course-select');
            select.innerHTML = '<option value="">-- Pilih Mata Kuliah --</option>';
            
            courses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.name;
                option.textContent = `${course.code} - ${course.name}`;
                select.appendChild(option);
            });
            
            // Juga populate untuk dropdown edit
            const editSelect = document.getElementById('edit-course');
            editSelect.innerHTML = '<option value="">-- Pilih Mata Kuliah --</option>';
            
            courses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.name;
                option.textContent = `${course.code} - ${course.name}`;
                editSelect.appendChild(option);
            });
        }

        // Populate course select dropdown untuk mahasiswa
        function populateStudentCourseSelect() {
            const select = document.getElementById('student-course-select');
            select.innerHTML = '<option value="">-- Pilih Mata Kuliah --</option>';
            
            courses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.name;
                option.textContent = `${course.code} - ${course.name}`;
                select.appendChild(option);
            });
        }

        // Load data absensi hari ini untuk admin
        function loadTodayAttendance() {
            const selectedCourse = document.getElementById('course-select').value;
            const selectedDate = document.getElementById('admin-date-select').value;
            
            if (!selectedCourse || !selectedDate) {
                alert("Pilih mata kuliah dan tanggal terlebih dahulu!");
                return;
            }
            
            const todayRecords = attendanceData.filter(a => a.date === selectedDate && a.course === selectedCourse);
            
            const tbody = document.getElementById('today-attendance-body');
            tbody.innerHTML = '';
            
            // Update info absensi
            document.getElementById('admin-attendance-info').textContent = 
                `Absensi ${selectedCourse} pada ${formatDate(selectedDate)}`;
            
            students.forEach((student, index) => {
                const row = document.createElement('tr');
                const existingRecord = todayRecords.find(r => r.nim === student.nim);
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${student.name}</td>
                    <td>${student.nim}</td>
                    <td>${student.class}</td>
                    <td>${student.category}</td>
                    <td>
                        <select class="form-control status-select" data-nim="${student.nim}" style="width: 120px;">
                            <option value="Hadir" ${existingRecord && existingRecord.status === 'Hadir' ? 'selected' : ''}>Hadir</option>
                            <option value="Izin" ${existingRecord && existingRecord.status === 'Izin' ? 'selected' : ''}>Izin</option>
                            <option value="Sakit" ${existingRecord && existingRecord.status === 'Sakit' ? 'selected' : ''}>Sakit</option>
                            <option value="Alpha" ${existingRecord && existingRecord.status === 'Alpha' ? 'selected' : ''}>Alpha</option>
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-primary btn-sm save-single" data-nim="${student.nim}">
                            <i class="fas fa-save"></i> Simpan
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Tambahkan event listener untuk tombol simpan per mahasiswa
            document.querySelectorAll('.save-single').forEach(button => {
                button.addEventListener('click', function() {
                    const nim = this.getAttribute('data-nim');
                    const statusSelect = document.querySelector(`.status-select[data-nim="${nim}"]`);
                    const status = statusSelect.value;
                    const course = document.getElementById('course-select').value;
                    const date = document.getElementById('admin-date-select').value;
                    
                    saveAttendanceRecord(nim, course, status, date);
                    alert(`Absensi untuk NIM ${nim} berhasil disimpan sebagai: ${status}`);
                });
            });
        }

        // Load riwayat absensi untuk mahasiswa
        function loadStudentAttendanceHistory(nim) {
            let studentAttendance = attendanceData.filter(a => a.nim === nim);
            
            // Filter berdasarkan tanggal jika ada
            const filterDate = document.getElementById('history-date-filter').value;
            if (filterDate) {
                studentAttendance = studentAttendance.filter(a => a.date === filterDate);
                document.getElementById('attendance-history-date').textContent = formatDate(filterDate);
            } else {
                document.getElementById('attendance-history-date').textContent = 'Semua Tanggal';
            }
            
            // Urutkan berdasarkan tanggal terbaru
            studentAttendance.sort((a, b) => b.timestamp - a.timestamp);
            
            const tbody = document.getElementById('student-attendance-history');
            tbody.innerHTML = '';
            
            if (studentAttendance.length === 0) {
                const row = document.createElement('tr');
                const message = filterDate ? 
                    `Belum ada riwayat absensi pada tanggal ${formatDate(filterDate)}` :
                    "Belum ada riwayat absensi";
                row.innerHTML = `<td colspan="4" style="text-align: center;">${message}</td>`;
                tbody.appendChild(row);
            } else {
                studentAttendance.forEach(record => {
                    const row = document.createElement('tr');
                    
                    let statusClass = 'status-absent';
                    if (record.status === 'Hadir') statusClass = 'status-present';
                    else if (record.status === 'Izin' || record.status === 'Sakit') statusClass = 'status-late';
                    
                    row.innerHTML = `
                        <td>${formatDate(record.date)}</td>
                        <td>${record.course}</td>
                        <td><span class="${statusClass}">${record.status}</span></td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editAttendanceRecord('${record.date}', '${record.course}', '${record.status}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
            }
        }

        // Fungsi untuk edit absensi (mahasiswa)
        window.editAttendanceRecord = function(date, course, status) {
            attendanceToEdit = attendanceData.find(a => 
                a.nim === currentUser.nim && 
                a.date === date && 
                a.course === course
            );
            
            if (attendanceToEdit) {
                document.getElementById('edit-attendance-info').textContent = 
                    `Edit absensi untuk: ${course} pada ${formatDate(date)}`;
                document.getElementById('edit-attendance-date').value = date;
                document.getElementById('edit-course').value = course;
                document.getElementById('edit-status').value = status;
                document.getElementById('edit-attendance-modal').style.display = 'flex';
            }
        };

        // Submit absensi untuk mahasiswa
        document.getElementById('submit-student-attendance').addEventListener('click', function() {
            const date = document.getElementById('attendance-date').value;
            const course = document.getElementById('student-course-select').value;
            const status = document.getElementById('student-status').value;
            
            if (!date || !course) {
                alert("Pilih tanggal dan mata kuliah terlebih dahulu!");
                return;
            }
            
            // Validasi tanggal tidak lebih dari hari ini
            const selectedDate = new Date(date);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (selectedDate > today) {
                alert("Tidak bisa absen untuk tanggal yang lebih besar dari hari ini!");
                return;
            }
            
            saveAttendanceRecord(currentUser.nim, course, status, date);
            alert(`Absensi untuk ${course} pada ${formatDate(date)} berhasil disimpan sebagai: ${status}`);
            
            // Refresh riwayat
            loadStudentAttendanceHistory(currentUser.nim);
            loadDashboardData();
        });

        // Simpan absensi untuk admin
        document.getElementById('save-attendance').addEventListener('click', function() {
            const selectedCourse = document.getElementById('course-select').value;
            const selectedDate = document.getElementById('admin-date-select').value;
            
            if (!selectedCourse || !selectedDate) {
                alert("Pilih mata kuliah dan tanggal terlebih dahulu!");
                return;
            }
            
            const statusSelects = document.querySelectorAll('.status-select');
            
            let savedCount = 0;
            statusSelects.forEach(select => {
                const nim = select.getAttribute('data-nim');
                const status = select.value;
                
                saveAttendanceRecord(nim, selectedCourse, status, selectedDate);
                savedCount++;
            });
            
            alert(`Absensi berhasil disimpan untuk ${savedCount} mahasiswa!`);
            loadDashboardData(); // Refresh dashboard
        });

        // Fungsi untuk menyimpan record absensi (dengan tanggal custom)
        function saveAttendanceRecord(nim, course, status, date = null) {
            const attendanceDate = date || new Date().toISOString().split('T')[0];
            const student = students.find(s => s.nim === nim);
            
            // Hapus record lama untuk tanggal dan mata kuliah yang sama
            attendanceData = attendanceData.filter(a => 
                !(a.nim === nim && a.date === attendanceDate && a.course === course)
            );
            
            // Tambahkan record baru
            attendanceData.push({
                nim: nim,
                name: student ? student.name : "Mahasiswa",
                course: course,
                date: attendanceDate,
                status: status,
                timestamp: new Date(attendanceDate).getTime()
            });
            
            // Simpan ke localStorage
            localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
        }

        // Load data mahasiswa untuk admin
        function loadStudentsTable() {
            const tbody = document.getElementById('students-table-body');
            tbody.innerHTML = '';
            
            students.forEach((student, index) => {
                // Hitung persentase kehadiran mahasiswa
                const studentAttendance = attendanceData.filter(a => a.nim === student.nim);
                const presentCount = studentAttendance.filter(a => a.status === "Hadir").length;
                const totalCount = studentAttendance.length;
                const percentage = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${student.nim}</td>
                    <td>${student.name}</td>
                    <td>${student.class}</td>
                    <td>${student.gender === 'L' ? 'Laki-laki' : 'Perempuan'}</td>
                    <td>${student.category}</td>
                    <td>${percentage}% (${presentCount}/${totalCount})</td>
                    <td>${'*'.repeat(student.password.length)}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editStudent('${student.nim}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-info btn-sm" onclick="resetPassword('${student.nim}')" style="margin-left: 5px;">
                            <i class="fas fa-key"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteStudent('${student.nim}')" style="margin-left: 5px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Setup pencarian
            document.getElementById('search-student').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const rows = tbody.querySelectorAll('tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });
            
            // Setup tombol tambah mahasiswa
            document.getElementById('add-student-btn').addEventListener('click', function() {
                const nim = prompt("Masukkan NIM mahasiswa baru:");
                if (!nim) return;
                
                const name = prompt("Masukkan nama mahasiswa:");
                if (!name) return;
                
                const studentClass = prompt("Masukkan kelas (A, B, C, atau K):");
                if (!studentClass) return;
                
                const gender = prompt("Masukkan jenis kelamin (L/P):");
                if (!gender) return;
                
                const category = prompt("Masukkan kategori (Reguler/Karyawan):");
                if (!category) return;
                
                const password = prompt("Masukkan password untuk mahasiswa:");
                if (!password) return;
                
                // Cek apakah NIM sudah ada
                if (students.find(s => s.nim === nim)) {
                    alert("NIM sudah terdaftar!");
                    return;
                }
                
                // Tambahkan mahasiswa baru
                students.push({
                    nim: nim,
                    name: name,
                    class: studentClass.toUpperCase(),
                    gender: gender.toUpperCase(),
                    category: category,
                    password: password
                });
                
                // Simpan ke localStorage
                localStorage.setItem('studentsData', JSON.stringify(students));
                
                // Reload tabel
                loadStudentsTable();
                alert("Mahasiswa berhasil ditambahkan!");
            });
        }

        // FUNGSI EDIT MAHASISWA
        window.editStudent = function(nim) {
            const student = students.find(s => s.nim === nim);
            if (!student) return;
            
            // Tampilkan form edit dengan semua data
            const newNim = prompt("Edit NIM mahasiswa (unik):", student.nim);
            if (!newNim) return;
            
            // Validasi: jika NIM diubah, pastikan NIM baru belum digunakan oleh mahasiswa lain
            if (newNim !== student.nim) {
                const nimExists = students.find(s => s.nim === newNim && s !== student);
                if (nimExists) {
                    alert("NIM sudah digunakan oleh mahasiswa lain!");
                    return;
                }
            }
            
            const newName = prompt("Edit nama mahasiswa:", student.name);
            if (!newName) return;
            
            const newClass = prompt("Edit kelas (A, B, C, atau K):", student.class);
            if (!newClass) return;
            
            const newGender = prompt("Edit jenis kelamin (L/P):", student.gender);
            if (!newGender) return;
            
            const newCategory = prompt("Edit kategori (Reguler/Karyawan):", student.category);
            if (!newCategory) return;
            
            const changePassword = confirm("Apakah Anda ingin mengubah password?");
            let newPassword = student.password;
            
            if (changePassword) {
                newPassword = prompt("Masukkan password baru:", student.password);
                if (!newPassword) return;
            }
            
            // Perbarui data absensi jika NIM berubah
            if (newNim !== student.nim) {
                // Update semua record absensi dengan NIM lama
                attendanceData.forEach(record => {
                    if (record.nim === student.nim) {
                        record.nim = newNim;
                    }
                });
                
                // Simpan perubahan absensi ke localStorage
                localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
            }
            
            // Update data mahasiswa
            student.nim = newNim;
            student.name = newName;
            student.class = newClass.toUpperCase();
            student.gender = newGender.toUpperCase();
            student.category = newCategory;
            student.password = newPassword;
            
            // Simpan perubahan ke localStorage
            localStorage.setItem('studentsData', JSON.stringify(students));
            
            // Reload tabel
            loadStudentsTable();
            loadDashboardData(); // Refresh dashboard karena data absensi mungkin berubah
            
            alert("Data mahasiswa berhasil diperbarui!");
        };

        // Fungsi reset password oleh admin
        window.resetPassword = function(nim) {
            const student = students.find(s => s.nim === nim);
            if (!student) return;
            
            document.getElementById('reset-student-info').textContent = `Untuk: ${student.name} (${student.nim})`;
            document.getElementById('save-password-btn').setAttribute('data-nim', nim);
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
            document.getElementById('reset-password-modal').style.display = 'flex';
        };

        // Fungsi hapus mahasiswa
        window.deleteStudent = function(nim) {
            if (confirm(`Apakah Anda yakin ingin menghapus mahasiswa dengan NIM ${nim}?`)) {
                students = students.filter(s => s.nim !== nim);
                
                // Simpan ke localStorage
                localStorage.setItem('studentsData', JSON.stringify(students));
                
                // Reload tabel
                loadStudentsTable();
                alert("Mahasiswa berhasil dihapus!");
            }
        };

        // Load data mata kuliah untuk admin
        function loadCoursesTable() {
            const tbody = document.getElementById('courses-table-body');
            tbody.innerHTML = '';
            
            courses.forEach((course, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${course.code}</td>
                    <td>${course.name}</td>
                    <td>${course.sks}</td>
                    <td>${course.lecturer}</td>
                    <td>${course.schedule}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editCourse('${course.code}')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Setup tombol tambah mata kuliah
            document.getElementById('add-course-btn').addEventListener('click', function() {
                const code = prompt("Masukkan kode mata kuliah baru:");
                if (!code) return;
                
                // Validasi kode unik
                if (courses.find(c => c.code === code)) {
                    alert("Kode mata kuliah sudah ada!");
                    return;
                }
                
                const name = prompt("Masukkan nama mata kuliah:");
                if (!name) return;
                
                const sks = prompt("Masukkan jumlah SKS:");
                if (!sks) return;
                
                const lecturer = prompt("Masukkan nama dosen pengampu:");
                if (!lecturer) return;
                
                const schedule = prompt("Masukkan jadwal (contoh: Senin, 08:00-10:30):");
                if (!schedule) return;
                
                // Tambahkan mata kuliah baru
                courses.push({
                    code: code,
                    name: name,
                    sks: parseInt(sks),
                    lecturer: lecturer,
                    schedule: schedule
                });
                
                // Reload tabel
                loadCoursesTable();
                populateCourseSelect(); // Refresh dropdown di halaman absensi
                populateStudentCourseSelect(); // Refresh dropdown untuk mahasiswa
                
                alert("Mata kuliah berhasil ditambahkan!");
            });
        }

        // Fungsi edit mata kuliah
        window.editCourse = function(code) {
            const course = courses.find(c => c.code === code);
            if (!course) return;
            
            const newCode = prompt("Edit kode mata kuliah:", course.code);
            if (!newCode) return;
            
            // Validasi: jika kode diubah, pastikan kode baru belum digunakan
            if (newCode !== course.code) {
                const codeExists = courses.find(c => c.code === newCode && c !== course);
                if (codeExists) {
                    alert("Kode mata kuliah sudah digunakan!");
                    return;
                }
            }
            
            const newName = prompt("Edit nama mata kuliah:", course.name);
            if (!newName) return;
            
            const newSks = prompt("Edit jumlah SKS:", course.sks);
            if (!newSks) return;
            
            const newLecturer = prompt("Edit dosen pengampu:", course.lecturer);
            if (!newLecturer) return;
            
            const newSchedule = prompt("Edit jadwal:", course.schedule);
            if (!newSchedule) return;
            
            // Perbarui data absensi jika nama mata kuliah berubah
            if (newName !== course.name) {
                // Update semua record absensi dengan nama mata kuliah lama
                attendanceData.forEach(record => {
                    if (record.course === course.name) {
                        record.course = newName;
                    }
                });
                
                // Simpan perubahan absensi ke localStorage
                localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
            }
            
            // Update data mata kuliah
            course.code = newCode;
            course.name = newName;
            course.sks = parseInt(newSks);
            course.lecturer = newLecturer;
            course.schedule = newSchedule;
            
            // Reload tabel
                loadCoursesTable();
                populateCourseSelect(); // Refresh dropdown di halaman absensi
                populateStudentCourseSelect(); // Refresh dropdown untuk mahasiswa
                
                alert("Data mata kuliah berhasil diperbarui!");
        };

        // Load data laporan untuk admin
        function loadReportData() {
            // Populate bulan filter
            const monthSelect = document.getElementById('report-month');
            monthSelect.innerHTML = '<option value="all">Semua Bulan</option>';
            
            const months = [
                'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
            ];
            
            months.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index + 1;
                option.textContent = month;
                monthSelect.appendChild(option);
            });
            
            // Set bulan sekarang sebagai default
            const currentMonth = new Date().getMonth() + 1;
            monthSelect.value = currentMonth;
            
            // Populate mata kuliah filter
            const courseSelect = document.getElementById('report-course');
            courseSelect.innerHTML = '<option value="all">Semua Mata Kuliah</option>';
            
            courses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.name;
                option.textContent = course.name;
                courseSelect.appendChild(option);
            });
            
            // Set tanggal default untuk filter
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            document.getElementById('report-start-date').value = firstDay.toISOString().split('T')[0];
            document.getElementById('report-end-date').value = today.toISOString().split('T')[0];
            
            // Generate report awal
            generateReport();
            
            // Event listener untuk tombol generate
            document.getElementById('generate-report').addEventListener('click', generateReport);
            
            // Event listener untuk tombol cetak
            document.getElementById('print-report').addEventListener('click', function() {
                window.print();
            });
        }

        // Generate laporan untuk admin
        function generateReport() {
            const selectedMonth = document.getElementById('report-month').value;
            const selectedCourse = document.getElementById('report-course').value;
            const selectedClass = document.getElementById('report-class').value;
            const startDate = document.getElementById('report-start-date').value;
            const endDate = document.getElementById('report-end-date').value;
            
            // Filter data absensi
            let filteredData = [...attendanceData];
            
            // Filter berdasarkan rentang tanggal
            if (startDate && endDate) {
                filteredData = filteredData.filter(record => {
                    return record.date >= startDate && record.date <= endDate;
                });
            }
            
            // Filter berdasarkan bulan (jika tidak menggunakan filter tanggal)
            if (selectedMonth !== 'all' && (!startDate || !endDate)) {
                filteredData = filteredData.filter(record => {
                    const recordMonth = parseInt(record.date.split('-')[1]);
                    return recordMonth === parseInt(selectedMonth);
                });
            }
            
            if (selectedCourse !== 'all') {
                filteredData = filteredData.filter(record => record.course === selectedCourse);
            }
            
            // Hitung statistik per mahasiswa dan mata kuliah
            const reportMap = {};
            
            filteredData.forEach(record => {
                const student = students.find(s => s.nim === record.nim);
                if (!student) return;
                
                // Filter berdasarkan kelas
                if (selectedClass !== 'all' && student.class !== selectedClass) return;
                
                const key = `${record.nim}-${record.course}`;
                
                if (!reportMap[key]) {
                    reportMap[key] = {
                        nim: record.nim,
                        name: student.name,
                        class: student.class,
                        course: record.course,
                        hadir: 0,
                        izin: 0,
                        sakit: 0,
                        alpha: 0,
                        total: 0
                    };
                }
                
                reportMap[key][record.status.toLowerCase()]++;
                reportMap[key].total++;
            });
            
            // Konversi ke array dan hitung persentase
            const reportArray = Object.values(reportMap).map(item => {
                const totalSessions = item.hadir + item.izin + item.sakit + item.alpha;
                const percentage = totalSessions > 0 ? Math.round((item.hadir / totalSessions) * 100) : 0;
                
                return {
                    ...item,
                    percentage: percentage
                };
            });
            
            // Urutkan berdasarkan kelas dan NIM
            reportArray.sort((a, b) => {
                if (a.class === b.class) {
                    return a.nim.localeCompare(b.nim);
                }
                return a.class.localeCompare(b.class);
            });
            
            // Tampilkan di tabel
            const tbody = document.getElementById('report-table-body');
            tbody.innerHTML = '';
            
            if (reportArray.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="11" style="text-align: center;">Tidak ada data absensi untuk filter yang dipilih</td>`;
                tbody.appendChild(row);
                return;
            }
            
            reportArray.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.nim}</td>
                    <td>${item.name}</td>
                    <td>${item.class}</td>
                    <td>${item.course}</td>
                    <td>${item.hadir}</td>
                    <td>${item.izin}</td>
                    <td>${item.sakit}</td>
                    <td>${item.alpha}</td>
                    <td>${item.total}</td>
                    <td>
                        <span class="${item.percentage >= 75 ? 'status-present' : item.percentage >= 50 ? 'status-late' : 'status-absent'}" style="padding: 5px 10px;">
                            ${item.percentage}%
                        </span>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Fungsi helper untuk format tanggal
        function formatDate(dateString) {
            const options = { day: 'numeric', month: 'short', year: 'numeric' };
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', options);
        }
    </script>
</body>
</html>
